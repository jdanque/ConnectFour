var ConnectFour=function(e,n){return n.settings={numToWin:4,board:{colSize:7,rowSize:6},player:[{name:"Player 1"},{name:"Player 2"}],updateSettings:function(){var i=e("#settings-name-player1").val(),t=e("#settings-name-player2").val(),a=e("#settings-size-col").val(),r=e("#settings-size-row").val();return i&&0!==i.length&&i.trim()?t&&0!==t.length&&t.trim()?isNaN(a)||1>a?(n.settings.showSettingsError("Invalid Column Size"),!1):isNaN(r)||1>r?(n.settings.showSettingsError("Invalid Row Size"),!1):(n.settings.player[0].name=i,n.settings.player[1].name=t,n.settings.board.colSize=a,n.settings.board.rowSize=r,!0):(n.settings.showSettingsError("Invalid Player 2 name"),!1):(n.settings.showSettingsError("Invalid Player 1 name"),!1)},showSettingsError:function(n){e(".options-error-wrapper").show().html(n)},hideSettingsError:function(){e(".options-error-wrapper").hide().html("")},init:function(){n.settings.numToWin=4,n.settings.board.colSize=7,n.settings.board.rowSize=6,n.settings.player=[{name:"Player 1"},{name:"Player 2"}],n.settings.hideSettingsError()}},n.init=function(){n.settings.init(),n.board.init(),n.game.init(),n.menu.init()},n.board={colSize:0,rowSize:0,turnCount:1,values:[],isFull:function(){return n.board.turnCount++,n.board.turnCount>n.board.colSize*n.board.rowSize?(n.game.status=2,!0):!1},initClickHandler:function(){e(".playingField").off("click.playerClick","td").on("click.playerClick","td",function(){if(n.game.status)return!1;var i=e(this).index(),t=n.game.currentPlayer+1,a=n.board.rowSize-1;a=n.game.getEmptyRowIndex(i),a>-1&&(n.board.values[a][i]=t,e(".playingField").find("tbody").find("tr").eq(a).find("td").eq(i).toggleClass("player"+t,!0),n.game.checkWinner(a,i,t)?n.game.showMessage(1,t):n.board.isFull()?n.game.showMessage(0):n.game.switchPlayer())})},init:function(){n.board.colSize=n.settings.board.colSize,n.board.rowSize=n.settings.board.rowSize,n.board.turnCount=1;var i,t=e(".playingField"),a="";for(n.board.values=[],i=0;i<n.board.rowSize;i++)n.board.values[i]=new Array(n.board.colSize).fill(0),a+="<tr>"+"<td></td>".repeat(n.board.colSize)+"</tr>";e(".playerTurn").html(n.settings.player[n.game.currentPlayer].name),t.find("tbody").html(a),n.board.initClickHandler()}},n.game={status:0,currentPlayer:0,showMessage:function(i){n.game.hideMessages(),e(".gameMessage.code-"+i).closest(".gameMessage").show(),e(".gameMessage-overlay").show(),i&&e(".gameMessage.code-"+i).find(".playerName").html(n.settings.player[n.game.currentPlayer].name)},hideMessages:function(){e(".gameMessage").hide(),e(".gameMessage-overlay").hide()},getEmptyRowIndex:function(e){for(var i=n.board.rowSize-1;i>-1&&0|n.board.values[i][e];)i--;return i},switchPlayer:function(){n.game.currentPlayer=1^n.game.currentPlayer,n.game.updatePlayerUI()},updatePlayerUI:function(){e(".playerTurn").removeClass("player1 player2").toggleClass("player"+(n.game.currentPlayer+1)).html(n.settings.player[n.game.currentPlayer].name)},checkWinner:function(e,i,t){var a=1,r=1,o=1,s=1,l=1,u=!0,g=!0,c=!0,d=!0,m=!0,y=!0,f=!0,p=!0;for(a=1;a<n.settings.numToWin;a++){var h=e-a,b=i-a,v=e+a,w=i+a;b>=0&&(u&&n.board.values[e][b]==t?r++:u=!1,m&&h>=0&&n.board.values[h][b]==t?s++:m=!1,y&&v<n.board.rowSize&&n.board.values[v][b]==t?l++:y=!1),w<n.board.colSize&&(g&&n.board.values[e][w]==t?r++:g=!1,f&&h>=0&&n.board.values[h][w]==t?l++:f=!1,p&&v<n.board.rowSize&&n.board.values[v][w]==t?s++:p=!1),h>=0&&(c&&n.board.values[h][i]==t?o++:c=!1),v<n.board.rowSize&&(d&&n.board.values[v][i]==t?o++:d=!1)}return n.game.status=r>=n.settings.numToWin||o>=n.settings.numToWin||s>=n.settings.numToWin||l>=n.settings.numToWin,n.game.status},initClickHandler:function(){e("body").off("click.gameOverlayClick",".gameMessage-overlay").on("click.gameOverlayClick",".gameMessage-overlay",function(){n.game.hideMessages()}),e("body").off("click.playAgain",".playAgain").on("click.playAgain",".playAgain",function(){n.game.hideMessages(),n.board.init(),n.game.init(),n.menu.hide()})},init:function(){n.game.status=0,n.game.currentPlayer=0,n.game.updatePlayerUI(),n.game.hideMessages(),n.game.initClickHandler()}},n.menu={initResetClickHandler:function(){e(".menu").off("click.reset","#settings-reset").on("click.reset","#settings-reset",function(){n.board.init(),n.game.init(),n.menu.hide(),n.game.hideMessages()})},initApplySettingsHandler:function(){e(".menu").off("click.apply","#settings-apply").on("click.apply","#settings-apply",function(){confirm("This will reset the game. Continue?")&&(n.settings.updateSettings()?(n.board.init(),n.game.init(),n.menu.hide()):n.game.status=3)})},show:function(){e(".options").animate({left:0},{duration:200,complete:function(){e(".menuOverlay").show()}})},hide:function(){e(".options").animate({left:"-100em"},{duration:200,complete:function(){e(".menuOverlay").hide(),n.settings.hideSettingsError()}})},initMenuClickHandler:function(){e(".header").off("click.menuClick",".menu-icon").on("click.menuClick",".menu-icon",function(){n.menu.show()}),e("body").off("click.menuOverlayClick",".menuOverlay").on("click.menuOverlayClick",".menuOverlay",function(){n.menu.hide()})},init:function(){n.menu.initMenuClickHandler(),n.menu.initResetClickHandler(),n.menu.initApplySettingsHandler()}},n}(jQuery,ConnectFour||{});jQuery(document).ready(function(){ConnectFour.init()});